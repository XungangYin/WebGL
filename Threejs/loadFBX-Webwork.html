<!DOCTYPE html>
<html lang="en">
<head>
    <title>Webwork_load_fbx</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body {
            font-family: Monospace;
            background-color: #fff;
            color: #fff;
            margin: 0px;
            overflow: hidden;
        }
        #info {
            color: #fff;
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            z-index: 100;
            display:block;
        }
        #replaceTexture {
            margin-top: 10px;
        }
        #info a, .button { color: #f00; font-weight: bold; text-decoration: underline; cursor: pointer }
    </style>
</head>

<body>
<div id="info">
    <input type="button" id="changeAction" value="ChangeAction" />
</div>

<script src="js/three_dev.js"></script>

<script src="js/libs/inflate.min.js"></script>
<script src="js/loaders/TGALoader_dev.js"></script>
<script src="js/loaders/FBXLoader.js"></script>


<script src="js/controls/OrbitControls.js"></script>

<script src="js/Detector.js"></script>
<script src="js/libs/stats.min.js"></script>
<script src="js/RaytracingRenderer.js"></script>


<script>

    if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

    var container, controls;
    var camera, scene, renderer, light;
    var changAction = false;
    var action;

    var clock = new THREE.Clock();

    var mixers = [];
    var actions = [];
    var worker;
    var data;

    init();

    function init() {


        container = document.createElement( 'div' );
        document.body.appendChild( container );

        camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 2000 );

        scene = new THREE.Scene();

        // grid
        // var gridHelper = new THREE.GridHelper( 28, 28, 0x303030, 0x303030 );
        // gridHelper.position.set( 0, - 0.04, 0 );
        // scene.add( gridHelper );

        // stats

        worker =  new Worker("loadFBX-Webworker.js");
        //worker.postMessage(scene);
        worker.onmessage =function (event) {

            console.log(event.data);
            data = event.data;

            scene.add(data);


        };
        worker.addEventListener("error",function (e) {
            console.log(e);
        })

        renderer = new THREE.WebGLRenderer();
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        renderer.setClearColor( 0xffffff );
        container.appendChild( renderer.domElement );

        // controls, camera
        controls = new THREE.OrbitControls( camera, renderer.domElement );
        controls.target.set( 0, 0, 0 );
        camera.position.set( 0, 0, 28 );
        //camera.position.set( 0, 0, 1028 );
        controls.update();

        window.addEventListener( 'resize', onWindowResize, false );

        light = new THREE.HemisphereLight(0xffffff, 0x444444, 1.0);
        light.position.set(0, 1, 0);
        scene.add(light);

        light = new THREE.DirectionalLight(0xffffff, 1.0);
        light.position.set(0, 1, 0);
        scene.add(light);

        // interaction

        var button = document.getElementById("changeAction");
         // button.addEventListener("click", onChangeAction);
       // button.addEventListener("click",  worker.onmessage );


        animate();

    }

    //

    function onChangeAction() {
        if (!changAction) {
            actions[1].stop();
            actions[0].play();
            changAction = true;
        }
        else {
            actions[0].stop();
            actions[1].play();
            changAction = false;
        }
    }



    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );

    }

    //

    function animate() {

        requestAnimationFrame( animate );

        // if ( mixers.length > 0 ) {
        //
        //     for ( var i = 0; i < mixers.length; i ++ ) {
        //
        //         mixers[ i ].update( clock.getDelta() );
        //
        //     }
        //
        // }


        render();

    }

    function render() {

        renderer.render( scene, camera );

    }

</script>

</body>
</html>
