<!DOCTYPE html>
<html lang="en">
<title>Demo 2 </title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<style>body { margin: 0px; overflow: hidden; }</style>
<link type="text/css" rel="stylesheet" href="stylesheet/3dhop.css"/> <!--链接样式表sst的通用方式 -->

<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/84/three.js"></script>-->
<script src="../js/three.js"></script>

<script src="../js/libs/CanvasRenderer.js"></script>
<!--JQUERY-->
<script src="js/jquery.js"></script>
<script src="js/TrackballControls.js"></script>

<script src="js/nexus.js"></script>
<script src="js/nexus_three.js"></script>
<script src = "../js/libs/stats.min.js"></script>
<script src = "../js/libs/dat.gui.min.js"></script>
<script src="../js/loaders/GLTFLoader.js"></script>

<script src = "js/init.js"></script>

<script src="../js/libs/inflate.min.js"></script>
<script src="../js/loaders/TGALoader_dev.js"></script>

</head>

<body>
<div id="container"></div>
<!--<canvas id="container"></canvas>-->
<div id="event" class ="3DModel" onmousedown="if(event.preventDefault) event.preventDefault() "></div>
<div id="toolbar">
    <img id="home" 		 	title="Home" 					src="img/dark/home.png"/><br/>
    <img id="zoomin" 	    title="Zoom In"					src="img/dark/zoomin.png"/><br/>
    <img id="light_on"      title="Disable Light Control"   src="img/dark/lightcontrol_on.png" style="position:absolute; visibility:hidden;"/>
    <img id="light"      	title="Enable Light Control"    src="img/dark/lightcontrol.png"    /><br/>
    <img id="measure_on"	title="Disable Measure tool"	src="img/dark/measure_on.png" style="..."/>
    <!--<img id="measure"		title="Enable Measure tool"		src="img/dark/measure.png"/><br/>-->

</div>

<div id="measure-box" class="output-box">Measured length<hr/><span id="measure-output" class="output-text" onmousedown="event.stopPropagation()">0.0</span></div>

</body>

<script>
    var container = document.getElementById( 'container');
    var renderer,scene,camera;
    var stats,controls;

    var raycaster,mouse,particleMaterial;

    var clock = new THREE.Clock();
    //var cloc1 = new THREE.Clock();

    renderer= new THREE.WebGLRenderer( { antialias: false } );
    renderer.setClearColor( 0xffffff );
    renderer.setPixelRatio( window.devicePixelRatio );
    renderer.setSize( window.innerWidth, window.innerHeight);
    //document.getElementById('container').appendChild(renderer.domElement);

    container.appendChild( renderer.domElement );


    camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.1, 2000 );
    camera.position.y = 3.2;
    camera.position.z = 1.2;

    // camera.position.set(0,0.2,0.8); //北航研究院
    //	camera.position.set(0,-1,0.5); //天津
    camera.lookAt({x:0,y:0,z:0});
    controls = new THREE.TrackballControls( camera,renderer.domElement ); //第二个参数防止该漫游器和dat.gui冲突
    // controls = new THREE.OrbitControls( camera,renderer.domElement );
    controls.rotateSpeed = 2.0;
    controls.zoomSpeed = 1.5;
    controls.panSpeed = 0.8;
    controls.noZoom = false;
    controls.noPan = false;
    controls.staticMoving = true;
    controls.dynamicDampingFactor = 0.3;


    scene = new THREE.Scene();
    scene.add( new THREE.AmbientLight( 0x333333 ) );

    var light1 = new THREE.DirectionalLight( 0xbbbbbb, 1.0 );
    light1.position.set( 0, 1, 1 );
    scene.add( light1 );

    var light2 = new THREE.DirectionalLight( 0x999999, 1.0 );
    light2.position.set( -1, -1, 0 );
    scene.add( light2 );

    function getURLParameter(name) {
        return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\+/g, '%20')) || null;
    }


    //var model = getURLParameter('model') || "models/tianjin_jpg.nxz";   //corto压缩后
    // var model = getURLParameter('model') || "models/bhqditi_yxg_y.nxz";
    //var model = getURLParameter('model') || "models/bhqditi_new_4000_simplified_3d_mesh_yxg.nxz";
    //  var model = getURLParameter('model') || "models/bhqditi_yxg.nxz";  //移除

    //var model1 = getURLParameter('model') || "models/bhqditi_yxg_no_texture.nxz";
    //var nexus_obj = new NexusObject(model, renderer, render);

    //var nexus_obj1 = new NexusObject( model1, renderer, render /*,material*/
    //var nexus_obj = new NexusObject( model, renderer, render /*,material*/);
    //  var group = new THREE.Group();
    //  group.add(nexus_obj);
    //scene.add(nexus_obj);

    var path  ="models/hd/KML0";
    for(var i = 1;i < 3;++i){
        var model = path+i+"_Y.nxs";
        nexus_obj = new NexusObject(model, renderer, render );
        scene.add(nexus_obj);
    }



    document.addEventListener("touchstart",onDocumentTouchStart,false);  //当手指触摸屏幕时触发
    window.addEventListener( 'resize', onWindowResize, false );
    render();

    //objects.push(nexus_obj);

    function onDocumentTouchStart( event ) {
        event.preventDefault();
        event.clientX = event.touches[0].clientX;
        event.clientY = event.touches[0].clientY;
        onDocumentMouseDown( event );
    }

    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize( window.innerWidth, window.innerHeight );

        controls.handleResize();
        controls.update();

        render();
    }

    var btmp = false;

    var b_camera = false;
    var value= 0;
    function cameraPath() {
        value+=clock.getDelta()*0.1;
        // camera.position.set(0,-2,value);
        //camera.lookAt({x:value,y:0,z:value});
        //nexus_obj.position.x+=0.0001;
        nexus_obj.rotation.y = value;
        //nexus_obj.position.x = 0.3*Math.sin(value);
        //nexus_obj.position.z = 0.3*Math.cos(value);
        //console.log(camera.position);
    }
    function animate() {
        render();
        requestAnimationFrame( animate );
        //   THREE.AnimationHandler.update(clock.getDelta());
        if (b_camera)
            cameraPath();
        controls.update();
    }

    function render() {
        Nexus.beginFrame(renderer.context);
        renderer.render( scene, camera );
        Nexus.endFrame(renderer.context);
    }


    function actionsToolbar(action) {
        if(action=='home')
        {
            //controls.reset();
            camControls.reset();
        }
        else if (action == "zoomin"){
            //controls.action = 2;
            camControls.enabled = false;
            // controls.track(controls.viewMatrix,0.0,0.0,1.1);
        }
        else if (action=="light" || action =="light_on" ){
            $('#light').css("visibility", "hidden");
            $('#light_on').css("visibility", "visible");
           // nexus_obj.visible = true;
            //nexus_obj1.visible = false;
            //_spidergl.postDrawEvent();
            b_camera = false;
        }
        else if(action=="measure"||action == "measure_on")
        {
            b_camera = true;
            //console.log(scene.children);
        }

    }


    //判断是否是手机端（若是pc返回true，否则返回false）
    function IsPC() {
        var userAgentInfo = navigator.userAgent;
        var Agents = ["Android", "iPhone",
            "SymbianOS", "Windows Phone",
            "iPad", "iPod"];
        var flag = true;
        for (var v = 0; v < Agents.length; v++) {
            if (userAgentInfo.indexOf(Agents[v]) > 0) {
                flag = false;
                break;
            }
        }
        return flag;
    }

    var flag = IsPC(); //true为PC端，false为手机端
    console.log(flag);

    init3D();
    animate();
    //   $('#measure-output').html(measure.toFixed(2) + " mm");

</script>


</html>

